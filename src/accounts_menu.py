from decimal import Decimal
from patterns.command import CreateAccountCommand, RecalculateBalanceCommand
from patterns.decorator import TimedCommandDecorator

def _show_accounts_menu(self):
    """
    –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ —Å—á–µ—Ç–∞–º–∏.
    –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞–º–∏,
    –∞ —Ç–∞–∫–∂–µ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –±–∞–ª–∞–Ω—Å–æ–≤.
    """
    while True:
        print("\n--- –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ß–ï–¢–ê–ú–ò ---")
        print("1. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤")
        print("2. –°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç")
        print("3. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–∞–Ω—Å")
        print("0. –ù–∞–∑–∞–¥")
        choice = input("–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é: ").strip()
        if choice == "1":
            self._list_accounts()
        elif choice == "2":
            self._create_account()
        elif choice == "3":
            self._recalculate_balance()
        elif choice == "0":
            break
        else:
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")


def _list_accounts(self):
    """
    –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç–∞.
    """
    accounts = self.account_facade.get_all_accounts()
    if not accounts:
        print("‚ùå –°—á–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—á–µ—Ç –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞–º–∏.")
        return

    print("\n--- –°–ü–ò–°–û–ö –°–ß–ï–¢–û–í ---")
    for account in accounts:
        print(f"ID: {account.id}, –ù–∞–∑–≤–∞–Ω–∏–µ: {account.name}, –ë–∞–ª–∞–Ω—Å: {account.balance}")

    print(f"\nüìä –í—Å–µ–≥–æ —Å—á–µ—Ç–æ–≤: {len(accounts)}")

def _create_account(self):
    """
    –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞.
    –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞,
    –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –ö–æ–º–∞–Ω–¥–∞ –∏ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
    —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.
    """
    name = input("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞: ").strip()
    try:
        initial_balance = Decimal(input("–í–≤–µ–¥–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ").strip())
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
        command = CreateAccountCommand(self.account_facade, name, initial_balance)
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        timed_command = TimedCommandDecorator(command)
        # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
        account = timed_command.execute()
        print(f"–°—á–µ—Ç —Å–æ–∑–¥–∞–Ω: {account.name} (ID: {account.id})")
        print(f"–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {timed_command.get_execution_time():.3f} —Å–µ–∫")
    except ValueError as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
    except Exception as e:
        print(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")

def _recalculate_balance(self):
    """
    –ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞.
    –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –ö–æ–º–∞–Ω–¥–∞ –∏ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
    —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.
    """
    try:
        account_id = int(input("–í–≤–µ–¥–∏—Ç–µ ID —Å—á–µ—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞: ").strip())
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –±–∞–ª–∞–Ω—Å–∞
        command = RecalculateBalanceCommand(self.account_facade, account_id)
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        timed_command = TimedCommandDecorator(command)
        new_balance = timed_command.execute()
        print(f"–ë–∞–ª–∞–Ω—Å –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω: {new_balance}")
        print(f"–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {timed_command.get_execution_time():.3f} —Å–µ–∫")
    except ValueError as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
    except Exception as e:
        print(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")